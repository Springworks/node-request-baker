'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = resolveAllOf;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

function resolveAllOf(spec) {
  if (!spec || typeof spec !== 'object') {
    return spec;
  }
  if (Array.isArray(spec)) {
    return spec.map(resolveAllOf);
  }
  const merged = spec.allOf ? inlineAllOf(spec) : spec;
  return _lodash2.default.mapValues(merged, resolveAllOf);
}

function inlineAllOf(spec) {
  const copy = _lodash2.default.omit(spec, 'allOf');
  return _lodash2.default.mergeWith.apply(_lodash2.default, [copy].concat(_toConsumableArray(spec.allOf), [unionIfArray]));
}

function unionIfArray(dest, src) {
  return Array.isArray(dest) ? _lodash2.default.union(dest, src) : undefined;
}
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typePicker = require('./type-picker');

var _typePicker2 = _interopRequireDefault(_typePicker);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function nextIndentation(indentation) {
  return `${indentation}  `;
}

function formatSchemaType(schema) {
  const type = _typePicker2.default.extractType(schema);
  if (type === 'string' && schema.enum) {
    return `(${type}: ${schema.enum.join(', ')})`;
  }
  return `(${type})`;
}

function formatListItem(name, schema, indentation, is_optional) {
  const type = formatSchemaType(schema);
  const desc = schema.description ? ` ${schema.description}` : '';
  return `${indentation}- ${name}${name ? ' ' : ''}${type}${is_optional ? ' (optional)' : ''}${desc}`;
}

function recursiveAppendLines(lines, name, schema, indentation, is_optional) {
  lines.push(formatListItem(name, schema, indentation, is_optional));

  if (schema.type === 'object' && schema.properties) {
    Object.keys(schema.properties).forEach(key => {
      const key_is_required = Array.isArray(schema.required) && schema.required.indexOf(key) >= 0;
      recursiveAppendLines(lines, key, schema.properties[key], nextIndentation(indentation), !key_is_required);
    });
  } else if (schema.type === 'array' && schema.items) {
    recursiveAppendLines(lines, '', schema.items, nextIndentation(indentation), false);
  }
}

const api = {
  createSchemaList: function createSchemaList(schema) {
    if (!schema.type && !schema.$ref) {
      return 'N/A';
    }
    const lines = [];
    recursiveAppendLines(lines, '', schema, '', false);
    return lines.join('\n');
  }
};

exports.default = api;